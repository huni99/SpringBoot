<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="com.winter.app.member.MemberDAO">
  	<resultMap type="MemberVO" id="resultMember">
  		<id property="username" column="USERNAME"/>
  		<result property="password" column="PASSWORD"/>
  		<result property="name" column="NAME"/>
  		<result property="email" column="EMAIL"/>
  		<result property="phone" column="PHONE"/>
  		<result property="birth" column="BIRTH"/>
  		<association property="memberProfile" javaType="ProfileVO" >
  			<id property="username" column="USERNAME"/>
  			<result property="saveName" column="SAVE_NAME"/>
  			<result property="oriName" column="ORI_NAME"/>
  		</association>
  		<collection property="roleVOs" javaType="java.util.List" ofType="RoleVO">
  			<id property="roleNum" column="ROLE_NUM"/>
  			<result property="roleName" column="ROLE_NAME"/>
  		</collection>
  	</resultMap>
  	<resultMap type="ProductVO" id="detailResult">
		<!-- PK Mapping  -->
			<id property="productNum" column="product_num"></id>
		<!-- 그외 나머지 -->
		<result property="productName" column="product_name"></result>
		<result property="productContents" column="product_contents"></result>
		<result property="productDate" column="product_date"></result>
		<result property="productRate" column="product_rate"></result>
		<result property="kindNum" column="kind_num" />
		
		<!-- 1:1 관계일때 -->
		<association property="productKindVO" javaType="ProductKindVO">
			<id property="kindNum" column="kind_num" />
			<result property="kindName" column="kind_name"/>
		</association>
	</resultMap>
  
  <insert id="insert" parameterType="MemberVO">
  	INSERT INTO MEMBERS
  	VALUES(
  	#{username},#{password},#{name},#{email},#{phone},#{birth},1,1,1,1
  	)
  </insert>
  <insert id="insertFile" parameterType="ProfileVO">
  INSERT INTO PROFILE
  VALUES(
  	#{username},#{saveName},#{oriName}
  )
  
  </insert>
  <insert id="addRole" parameterType="java.util.Map">
  	INSERT INTO MEMBER_ROLE(USERNAME,ROLE_NUM)
  	VALUES(#{username},#{roleNum})
  </insert>
  <select id ="check" resultType ="MemberVO">
  	select * from MEMBERS
  	WHERE USERNAME=#{username} and PASSWORD=#{password}
  </select>
  <select id="detail" parameterType="MemberVO" resultMap="resultMember">
  	SELECT * FROM MEMBERS m
  	JOIN MEMBER_ROLE mr ON mr.USERNAME= m.USERNAME
	JOIN ROLE r ON r.ROLE_NUM=mr.ROLE_NUM
   	JOIN PROFILE p ON p.USERNAME= m.USERNAME
   	WHERE m.USERNAME=#{username}
  
  </select>
  
  <insert id="cartAdd" parameterType="java.util.Map">
  	INSERT INTO CART
  	VALUES(#{username},#{productNum})
  	
  </insert>
  <select id="cartList" parameterType="MemberVO" resultMap="detailResult">
  	SELECT * 
  	FROM PRODUCTS P
  		INNER JOIN
		PRODUCTS_KIND K
		USING(KIND_NUM)
  	WHERE
 		P.PRODUCT_NUM IN(
 						SELECT PRODUCT_NUM FROM CART
 						WHERE USERNAME=#{username}
 							)
  
  
  </select>
  <delete id="cartDelete" parameterType="java.util.Map">
  	DELETE FROM CART
  	WHERE USERNAME=#{username.username} AND PRODUCT_NUM=#{productNum}
  
  </delete>
  
  </mapper>